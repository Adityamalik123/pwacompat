(function(){function n(){var a=document.head.querySelector('link[rel="manifest"]'),b=a?a.href:"";Promise.resolve().then(function(){if(!b)throw'can\'t find <link rel="manifest" href=".." />\'';var a={};"use-credentials"===b.crossOrigin&&(a.credentials="include");return window.fetch(b,a)}).then(function(a){return a.json()}).then(function(a){return z(a,b)}).catch(function(a){return console.warn("pwacompat.js error",a)})}function r(a,b){a=document.createElement(a);for(var c in b)a.setAttribute(c,b[c]);
document.head.appendChild(a);return a}function g(a,b){b&&(!0===b&&(b="yes"),r("meta",{name:a,content:b}))}function z(a,b){function c(b,c,f){var h=b.width,d=b.height,e=window.devicePixelRatio;b=t({width:h*e,height:d*e});b.scale(e,e);b.fillStyle=a.background_color||"#f8f9fa";b.fillRect(0,0,h,d);b.translate(h/2,(d-32)/2);b.font="24px HelveticaNeue-CondensedBold";b.fillStyle=n?"white":"black";h=b.measureText(u).width;f&&(d=f.width/e,e=f.height/e,128<e&&(d/=e/128,e=128),48<=d&&48<=e&&(b.drawImage(f,d/
-2,e/-2,d,e),b.translate(0,e/2+32)));b.fillText(u,h/-2,0);f=document.createElement("link");f.setAttribute("rel","apple-touch-startup-image");f.setAttribute("media","(orientation: "+c+")");f.setAttribute("href",b.canvas.toDataURL());return f}function d(a){var b=c(window.screen,"portrait",a);a=c({width:window.screen.height,height:window.screen.width},"landscape",a);v.forEach(function(a){return a.remove()});document.head.appendChild(b);document.head.appendChild(a);v.add(b);v.add(a)}var k=a.icons||[];
k.sort(function(a,b){return parseInt(b.sizes,10)-parseInt(a.sizes,10)});var w=k.map(function(a){a={rel:"icon",href:new URL(a.src,b),sizes:a.sizes};r("link",a);if(p)return a.rel="apple-touch-icon",r("link",a)});k=-1!==A.indexOf(a.display);g("mobile-web-app-capable",k);B(a.theme_color||"black");C&&(g("msapplication-starturl",a.start_url||"/"),g("msapplication-TileColor",a.theme_color));if(p){var n=x(a.background_color||"#f8f9fa"),u=a.name||a.short_name||document.title,l=D(a.related_applications);l&&
g("apple-itunes-app","app-id="+l);g("apple-mobile-web-app-capable",k);g("apple-mobile-web-app-title",u);var v=new Set;d(null);if(w.length){var m=w[0],q=new Image;q.onload=function(){d(q);if(a.background_color){var b=y(q,a.background_color);null!==b&&(m.href=b,w.slice(1).forEach(function(b){var c=new Image;c.onload=function(){var d=y(c,a.background_color,!0);b.href=d};c.src=b.href}))}};q.src=m.href}}}function D(a){var b;(a||[]).filter(function(a){return"itunes"===a.platform}).forEach(function(a){a.id?
b=a.id:(a=a.url.match(/id(\d+)/))&&(b=a[1])});return b}function B(a){if(p||E){var b=x(a);if(p)g("apple-mobile-web-app-status-bar-style",b?"default":"black");else{try{var c=Windows.UI.ViewManagement.ApplicationView.getForCurrentView().titleBar}catch(d){c=null}null===c?console.debug("found Windows, could not fetch titleBar"):(b=l(b?"black":"white"),a=l(a),c.foregroundColor=b,c.backgroundColor=a,c.buttonForegroundColor=b,c.buttonBackgroundColor=a,c.inactiveForegroundColor=b,c.inactiveBackgroundColor=
a,c.buttonInactiveForegroundColor=b,c.buttonInactiveBackgroundColor=a)}}}function l(a){a=m(a);return{r:a[0],g:a[1],b:a[2],a:a[3]}}function m(a){var b=t();b.fillStyle=a;b.fillRect(0,0,1,1);return b.getImageData(0,0,1,1).data}function x(a){a=m(a).map(function(a){a/=255;return.03928>a?a/12.92:Math.pow((a+.055)/1.055,2.4)});return 3<Math.abs(1.05/(.2126*a[0]+.7152*a[1]+.0722*a[2]+.05))}function y(a,b,c){c=void 0===c?!1:c;var d=t(a);d.drawImage(a,0,0);if(!c&&255==d.getImageData(0,0,1,1).data[3])return null;
d.globalCompositeOperation="destination-over";d.fillStyle=b;d.fillRect(0,0,a.width,a.height);return d.canvas.toDataURL()}function t(a){a=void 0===a?{width:1,height:1}:a;var b=a.height,c=document.createElement("canvas");c.width=a.width;c.height=b;return c.getContext("2d")}if("fetch"in window){var A=["standalone","fullscreen","minimal-ui"],p=navigator.vendor&&-1!==navigator.vendor.indexOf("Apple"),C=navigator.userAgent&&-1!==navigator.userAgent.indexOf("Edge"),E="undefined"!==typeof Windows;"complete"===
document.readyState?n():window.addEventListener("load",n)}})();
