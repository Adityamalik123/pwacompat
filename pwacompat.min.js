(function(){function h(){var a=document.head.querySelector('link[rel="manifest"]'),b=a?a.href:"";Promise.resolve().then(function(){if(!b)throw'can\'t find <link rel="manifest" href=".." />\'';var a={};"use-credentials"===b.crossOrigin&&(a.credentials="include");return window.fetch(b,a)}).then(function(a){return a.json()}).then(function(a){return A(a,b)}).catch(function(a){return console.warn("pwacompat.js error",a)})}function r(a,b){a=document.createElement(a);for(var d in b)a.setAttribute(d,b[d]);
document.head.appendChild(a);return a}function c(a,b){b&&(!0===b&&(b="yes"),r("meta",{name:a,content:b}))}function A(a,b){function d(b,d,f){var k=b.width,c=b.height,e=window.devicePixelRatio;b=t({width:k*e,height:c*e});b.scale(e,e);b.fillStyle=a.background_color||"#f8f9fa";b.fillRect(0,0,k,c);b.translate(k/2,(c-32)/2);b.font="24px HelveticaNeue-CondensedBold";b.fillStyle=q?"white":"black";k=b.measureText(u).width;f&&(c=f.width/e,e=f.height/e,128<e&&(c/=e/128,e=128),48<=c&&48<=e&&(b.drawImage(f,c/
-2,e/-2,c,e),b.translate(0,e/2+32)));b.fillText(u,k/-2,0);f=document.createElement("link");f.setAttribute("rel","apple-touch-startup-image");f.setAttribute("media","(orientation: "+d+")");f.setAttribute("href",b.canvas.toDataURL());return f}function v(a){var b=d(window.screen,"portrait",a);a=d({width:window.screen.height,height:window.screen.width},"landscape",a);w.forEach(function(a){return a.remove()});document.head.appendChild(b);document.head.appendChild(a);w.add(b);w.add(a)}var g=a.icons||[];
g.sort(function(a,b){return parseInt(b.sizes,10)-parseInt(a.sizes,10)});var x=g.map(function(a){a={rel:"icon",href:new URL(a.src,b),sizes:a.sizes};r("link",a);if(m)return a.rel="apple-touch-icon",r("link",a)}),n=a.display;g=-1!==B.indexOf(n);c("mobile-web-app-capable",g);C(a.theme_color||"black");D&&(c("msapplication-starturl",a.start_url||"/"),c("msapplication-TileColor",a.theme_color));var h=E(a.orientation);c("x5-orientation",h);c("screen-orientation",h);"fullscreen"===n?(c("x5-fullscreen","true"),
c("full-screen","yes")):g&&(c("x5-page-mode","app"),c("browsermode","application"));if(m){var q=y(a.background_color||"#f8f9fa"),u=a.name||a.short_name||document.title;(n=F(a.related_applications))&&c("apple-itunes-app","app-id="+n);c("apple-mobile-web-app-capable",g);c("apple-mobile-web-app-title",u);var w=new Set;v(null);if(x.length){var l=x[0],p=new Image;p.onload=function(){v(p);if(a.background_color){var b=z(p,a.background_color);null!==b&&(l.href=b,x.slice(1).forEach(function(b){var d=new Image;
d.onload=function(){var c=z(d,a.background_color,!0);b.href=c};d.src=b.href}))}};p.src=l.href}}}function F(a){var b;(a||[]).filter(function(a){return"itunes"===a.platform}).forEach(function(a){a.id?b=a.id:(a=a.url.match(/id(\d+)/))&&(b=a[1])});return b}function E(a){a=String(a||"");a=a.substr(0,3);return"por"===a?"portrait":"lan"===a?"landscape":""}function C(a){if(m||G){var b=y(a);if(m)c("apple-mobile-web-app-status-bar-style",b?"default":"black");else{try{var d=Windows.UI.ViewManagement.ApplicationView.getForCurrentView().titleBar}catch(v){d=
null}null===d?console.debug("found Windows, could not fetch titleBar"):(b=q(b?"black":"white"),a=q(a),d.foregroundColor=b,d.backgroundColor=a,d.buttonForegroundColor=b,d.buttonBackgroundColor=a,d.inactiveForegroundColor=b,d.inactiveBackgroundColor=a,d.buttonInactiveForegroundColor=b,d.buttonInactiveBackgroundColor=a)}}}function q(a){a=l(a);return{r:a[0],g:a[1],b:a[2],a:a[3]}}function l(a){var b=t();b.fillStyle=a;b.fillRect(0,0,1,1);return b.getImageData(0,0,1,1).data}function y(a){a=l(a).map(function(a){a/=
255;return.03928>a?a/12.92:Math.pow((a+.055)/1.055,2.4)});return 3<Math.abs(1.05/(.2126*a[0]+.7152*a[1]+.0722*a[2]+.05))}function z(a,b,d){d=void 0===d?!1:d;var c=t(a);c.drawImage(a,0,0);if(!d&&255==c.getImageData(0,0,1,1).data[3])return null;c.globalCompositeOperation="destination-over";c.fillStyle=b;c.fillRect(0,0,a.width,a.height);return c.canvas.toDataURL()}function t(a){a=void 0===a?{width:1,height:1}:a;var b=a.height,c=document.createElement("canvas");c.width=a.width;c.height=b;return c.getContext("2d")}
if("fetch"in window){var B=["standalone","fullscreen","minimal-ui"],m=navigator.vendor&&-1!==navigator.vendor.indexOf("Apple"),D=navigator.userAgent&&-1!==navigator.userAgent.indexOf("Edge"),G="undefined"!==typeof Windows;"complete"===document.readyState?h():window.addEventListener("load",h)}})();
